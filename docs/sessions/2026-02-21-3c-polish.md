# Session: ADR-007 Phase 3C — Polish

**Date:** 2026-02-21
**Status:** Complete

---

## Scope

ADR-007 Phase 3C (partial): auto-install taps, manual sync trigger, error alerting review.
Webhooks explicitly deferred.

---

## Changes

### 1. Auto-install taps (`connector-manager/src/runners/named.rs`)

In `run_tap_once`, when the tap binary is not found on PATH (`ErrorKind::NotFound`):
1. Runs `pip install {tap_name}` as a subprocess
2. If pip succeeds, retries spawning the tap
3. If pip fails or pip itself is not found, returns a descriptive error that propagates to `last_error`

The error is surfaced in the UI via the existing `last_error` display in the connector panel.

### 2. Manual sync trigger

**`named.rs`** — Added `trigger_sync(&self, source_id: &str) -> Result<()>` to `NamedRunner`:
- Loads config from `NamedConfigStore` (returns Err if not found)
- Spawns a one-shot `run_tap_once` tokio task (fire and forget)
- Result is recorded in `status_map` (`last_error`, `restart_count`) when the task completes

**`api.rs`** — Added:
- `handle_sync_named_source` (thin wrapper calling `trigger_sync`)
- `post_sync_named_source` HTTP handler → returns `202 Accepted`
- Route: `POST /api/connectors/named/:source_id/sync`

**`ui/public/index.html`** — Added:
- "Sync Now" button (blue, next to Remove) in the named connector row
- `syncNamedSource(sourceId)` JS function: POSTs to `/api/connector-manager/connectors/named/{id}/sync`, then refreshes connector status

### 3. Error alerting

No changes needed. The UI already displays `last_error` per connector (red text below the connector row). Auto-install failures propagate through the same path.

---

## Files Modified

- `connector-manager/src/runners/named.rs` — auto-install logic, `trigger_sync` method
- `connector-manager/src/api.rs` — sync handler + route
- `ui/public/index.html` — Sync Now button + JS function

---

## Build & Test

Run:
```
docker compose build --no-cache connector-manager && docker compose up -d connector-manager
docker compose build --no-cache flux-ui && docker compose up -d flux-ui
```

Verify:
1. Add a named source with a tap not yet installed → should auto-install on first run
2. Click "Sync Now" on a named connector → connector panel refreshes, tap runs immediately
3. If tap fails, error is shown in red under the connector row

---

## Out of Scope (Phase 3C remainder)

- Webhooks (deferred — complex, not requested this session)
- Resource limits (configurable max subprocesses) — deferred
- Documentation user guide — deferred
